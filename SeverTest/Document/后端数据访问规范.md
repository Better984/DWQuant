# 后端数据访问规范（简版）

## 目标
- 保持 Controller 简洁，只负责鉴权、参数校验与返回结果。
- 业务逻辑集中在 Application/Service，数据访问集中在 Repository。
- SQL 只出现在 Repository 层，避免散落到 Service/Controller。

## 分层约定
- Controller -> Application(Service) -> Repository -> DbManager
- Repository 负责单一功能域的数据访问，统一管理该功能的 SQL。
- 需要跨表/跨模块的数据读取时，优先封装为 Repository 方法再由 Service 调用。

## 示例（便于对照）
- 通知偏好默认渠道查询：封装到 `SeverTest/Modules/Notifications/Infrastructure/NotificationAccountRepository.cs`。
- 策略运行时加载：封装到 `SeverTest/Modules/StrategyRuntime/Infrastructure/StrategyRuntimeRepository.cs`。
- 历史行情维护与检查：封装到 `SeverTest/Modules/MarketData/Infrastructure/MarketDataMaintenanceRepository.cs` 与 `SeverTest/Modules/MarketData/Infrastructure/HistoricalMarketDataRepository.cs`。

## 最小化改动原则
- 以“可维护、易读”为先，避免过度抽象。
- 每次改动先做一个模块试点，确认清晰后再推广到其它模块。

## 模块目录
- 通知模块：SeverTest/Modules/Notifications/{Application,Infrastructure,Domain,Sql}
- 历史行情模块：SeverTest/Modules/MarketData/{Application,Infrastructure,Domain,Sql}
- 行情订阅模块：SeverTest/Modules/MarketStreaming/{Application,Infrastructure,Domain,Sql}
- 监控模块：SeverTest/Modules/Monitoring/{Application,Infrastructure,Domain,Sql}
- 广播模块：SeverTest/Modules/AdminBroadcast/{Application,Infrastructure,Domain,Sql}
- 策略运行模块：SeverTest/Modules/StrategyRuntime/{Application,Infrastructure,Domain,Sql}
- 策略管理：SeverTest/Modules/StrategyManagement/{Application,Infrastructure,Domain,Sql}
- 账户鉴权与交易设置：SeverTest/Modules/Accounts/{Application,Infrastructure,Domain,Sql}
- 交易所 API Key：SeverTest/Modules/ExchangeApiKeys/{Application,Infrastructure,Domain,Sql}
- 仓位与风控：SeverTest/Modules/Positions/{Application,Infrastructure,Domain,Sql}
- 策略核心执行：SeverTest/Modules/StrategyEngine/{Application,Infrastructure,Domain,Sql}
- 交易执行：SeverTest/Modules/TradingExecution/{Application,Infrastructure,Domain,Sql}
