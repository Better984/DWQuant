# 运行时间模板与日历

> 目的：统一管理服务端运行时间模板、日历异常与模板 ID，供前端选择与后端判定使用。

---

## 一、模板设计要点

- 策略配置仅保存 `templateIds`，模板详情由服务端接口提供（数据库存储）。
- 模板支持分钟级时间段（如 09:30），自定义时间仍保持小时级。
- 模板可挂载交易日历，用于节假日休市、临时加开或提前收市等异常。
- 存量策略没有 `runtime` 字段时视为全天运行。

## 二、模板字段说明

- `id`：模板唯一标识（字符串），策略只保存该 ID。
- `name`：模板名称（前端展示）。
- `timezone`：模板时区（IANA/Windows 均可，服务端会做映射）。
- `days`：生效星期（mon/tue/…）。
- `timeRanges`：时间段数组（允许分钟级）。
- `calendar`：日历异常（可选）。

### 日历异常类型

- `Closed`：当日完全休市。
- `Override`：当日使用给定时间段替代基础时间段。
- `Append`：当日额外追加时间段（基础时间段仍生效）。

## 三、模板存储与管理

- 表：`strategy_runtime_template`
- 字段：
  - `template_id`：模板 ID
  - `name`：模板名称
  - `timezone`：时区
  - `days_json`：星期数组 JSON
  - `time_ranges_json`：时间段数组 JSON
  - `calendar_json`：日历异常数组 JSON
  - `created_at` / `updated_at`
- 管理端入口：后台管理 → 服务器配置 → 运行时间模板（支持列表/新增/编辑/删除）。

## 四、默认模板（数据库初始化）

### 1) `cn.a_share.regular`

- 名称：A 股交易时间
- 时区：`Asia/Shanghai`
- 周期：周一至周五
- 时间段：`09:30-11:30`、`13:00-15:00`
- 日历：暂未内置节假日（后续可按年补充）

### 2) `us.equity.et.extended`

- 名称：美股（ET）盘前 + 正常时段
- 时区：`America/New_York`
- 周期：周一至周五
- 时间段：`04:00-09:30`、`09:30-16:00`
- 日历（2026 示例）：
  - `2026-02-16`（Presidents Day）：Closed
  - `2026-04-03`（Good Friday）：Closed

## 五、接口

- 前端策略侧：`POST /api/strategy/runtime/templates`（`strategy.runtime.template.list`）返回 `templates` 与 `timezones`。
- 管理端：
  - `POST /api/admin/runtime-template/list`（`admin.runtime-template.list`）
  - `POST /api/admin/runtime-template/create`（`admin.runtime-template.create`）
  - `POST /api/admin/runtime-template/update`（`admin.runtime-template.update`）
  - `POST /api/admin/runtime-template/delete`（`admin.runtime-template.delete`）

## 六、策略配置示例

```
"runtime": {
  "scheduleType": "Template",
  "outOfSessionPolicy": "BlockEntryAllowExit",
  "templateIds": ["us.equity.et.extended"]
}
```

---

如需新增模板或补齐节假日日历，请通过后台管理入口维护并同步前端展示。
