# 服务器配置管理

> 目标：将部分 `appsettings.json` 配置迁移到数据库，支持后台分类展示与管理员更新；根据配置标注是否实时生效。

---

## 一、数据表

- 表名：`server_config`
- 用途：存储服务器可控参数与说明信息

字段说明：
- `config_key`：配置键（使用 `:` 分隔层级，如 `RateLimit:HttpRps`）
- `category`：分类（后台分组显示）
- `value_type`：值类型（`string` / `int` / `decimal` / `bool` / `json`）
- `value_text`：配置值（字符串存储）
- `description`：配置说明（简短注释 + 是否实时生效）
- `is_realtime`：是否实时生效（1=实时，0=需重启）
- `updated_by`：最后修改人（uid）
- `created_at` / `updated_at`

---

## 二、后台入口

- 路由：`/server-config`
- Tab：
  - 服务器配置（参数列表 + 编辑）
  - 运行时间模板（沿用模板管理页面）

---

## 三、接口

- `POST /api/admin/server-config/list`（`admin.server-config.list`）
- `POST /api/admin/server-config/update`（`admin.server-config.update`）

---

## 四、实时生效说明

- 标注为“实时生效”的参数会在运行中读取数据库配置（无需重启）。
- 标注为“需重启”的参数仅在应用启动时生效，更新后需重启服务。

---

## 五、注意事项

- 不建议将密钥/连接串等敏感配置纳入数据库管理。
- 新增可控参数时需同步更新 `ServerConfigDefinitions` 与本文档。
- 回测并行相关参数示例：
  - `Backtest:MaxConcurrentTasks`：任务级并发上限。
  - `Backtest:InnerParallelism`：单任务主循环在同一时间点的 symbol 并行度（`<=0` 按 CPU 核心数）。
  - `Backtest:ExecutionModeDefault`：默认执行模式（`batch_open_close`/`timeline`）。
  - `Backtest:BatchCloseParallelism`：批量模式统一平仓并行度（`<=0` 按 CPU 核心数）。
  - `Backtest:BatchAllowOverlappingPositions`：批量模式是否允许重叠仓位。
  - `Backtest:ObjectPool:BarDictionaryPrewarm`：回测对象池 K 线字典预热数量（需重启）。
  - `Backtest:ObjectPool:ConditionResultListPrewarm`：回测对象池条件结果列表预热数量（需重启）。
  - `Backtest:ObjectPool:StrategyMethodListPrewarm`：回测对象池条件方法列表预热数量（需重启）。
  - `Backtest:ObjectPool:TimestampSetPrewarm`：回测对象池时间戳集合预热数量（需重启）。
  - `Backtest:ObjectPool:IndicatorTaskPrewarm`：回测对象池指标任务预热数量（需重启）。
  - `Backtest:ObjectPool:StrategyContextPrewarm`：回测对象池策略上下文预热数量（需重启）。
- 分布式回测与节点通信参数示例：
  - `BacktestWorker:DispatchPollingIntervalMs`：核心节点任务分发轮询间隔（需重启）。
  - `BacktestWorker:HeartbeatSeconds`：算力节点心跳间隔（需重启）。
  - `BacktestWorker:ReconnectDelaySeconds`：算力节点断线重连间隔（需重启）。
  - `BacktestWorker:MaxParallelTasksPerWorker`：单算力节点并行任务上限（需重启）。
  - `BacktestWorker:CoreWsUrls`（`|` 分隔多地址）、`BacktestWorker:CoreWsUrl`（单地址兼容）与 `BacktestWorker:AccessKey` 建议保留在 `appsettings*.json`（路由/密钥敏感项，不建议入库）。
  - 启动时可通过 `ServerRoleBootstrap` 交互录入 `CoreWsUrls`，结果会持久化到 `Config/server-role.local.json` 并在本次启动优先生效。
- 行情订阅存储参数示例：
  - `MarketStreaming:UseRedisSubscriptionStore`：是否使用 Redis 存储行情订阅关系（需重启）。
