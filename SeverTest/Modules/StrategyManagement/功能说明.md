# StrategyManagement 模块功能说明

## 功能概述
- 策略定义、版本与配置管理（增删改查）。
- 面向用户的策略管理入口。
- 运行时间配置校验（自定义按小时精度，模板可分钟；模板仅保存模板 ID）。
- 运行时间模板列表查询（数据库模板库 + 缓存）。

## 主要入口
- 控制器：`Controllers/StrategyController.cs`
- 服务/仓储：`Application/StrategyService.cs`、`Infrastructure/StrategyRepository.cs`

## 联动关系
- `Accounts`：策略归属与权限校验。
- `ExchangeApiKeys`：策略与交易所 API Key 绑定信息。
- `StrategyEngine`：策略内容与校验逻辑。
- `StrategyRuntime`：运行时加载与状态管理。

## 前端联动（StrategyDetailDialog）
- 回测页签的“回测结果”新增全屏专用工作台入口（按钮：`backtest-fullscreen-btn`）。
- 全屏工作台布局：
  - 左侧：`MarketChart` 行情图表组件（根据回测参数/结果映射 `exchange:symbol` 与 `interval`）。
  - 右侧：回测结果明细（汇总统计、按标的交易明细、资金曲线、事件日志）。
- 全屏工作台为弹层模式，支持遮罩点击和 `Esc` 退出，不再使用“结果卡片直接固定定位撑满屏幕”的方式。
- 交易明细联动图表：
  - 在回测结果的“交易明细”表格中点击某条仓位，会触发图表焦点联动。
  - 联动流程为：前端根据仓位开平仓时间发起 `marketdata.kline.history` 请求（附带前后缓冲区间）→ `MarketChart` 切换并渲染该区间 K 线。
  - 图中会标记开仓/平仓时点与仓位区间，帮助用户快速定位该仓位的触发与演变过程。
  - `MarketChart` 采用“数据版本号”保护历史加载与焦点加载，避免并发请求回写导致区间错位或普通历史数据覆盖焦点区间。
  - 焦点模式新增统一退出恢复：当 `focusRange` 被清空、symbol/interval 不匹配或焦点加载失败时，会清理焦点覆盖层并回退到常规历史窗口，恢复实时更新。
  - 绘图工具图标渲染增加容错：当 SVG 资源未被 `svgr` 转换为 React 组件、仅返回 URL 字符串时，前端自动回退为 `<img>` 渲染，避免 `InvalidCharacterError` 导致页面崩溃。
