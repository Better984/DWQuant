# Shared 模块功能说明

## 功能概述
- 提供通用基础设施：数据库、缓存、对象存储、协议封装、公共模型、中间件与限流。
- 提供服务器配置中心（数据库存储 + 启动初始化 + 运行时读取）。
- 提供服务器角色启动引导（核心节点 / 回测算力节点 / 全功能节点）与本地默认角色持久化。
- 角色引导支持三步交互：选择模式、选择是否更新分布式核心节点地址（`|` 分隔）、确认启动。
- 作为各业务模块的基础依赖层。

## 主要入口
- 服务：`Application/Services/DatabaseService.cs`、`Application/Services/RedisCacheService.cs`、`Application/Services/OSSService.cs`、`Application/Services/ServerConfigService.cs`
- 角色与启动：`Application/Services/ServerRoleBootstrap.cs`、`Application/Services/ServerRoleRuntime.cs`、`Application/Services/SystemStartupManager.cs`
- 配置中心：`Infrastructure/Config/ServerConfigRepository.cs`、`Infrastructure/Config/ServerConfigStore.cs`
- 协议与过滤器：`Protocol/*`、`ProtocolRequestFilter.cs`、`ProtocolResponseFilter.cs`
- 中间件：`Middleware/ExceptionHandlingMiddleware.cs`、`Middleware/SystemReadinessMiddleware.cs`
- 选项与校验：`Options/*`、`Options/Validation/*`

## 配置选项
- `DbOptions`：数据库连接与慢查询阈值
- `HistoricalMarketDataOptions`：历史行情同步与预加载
- `RuntimeQueueOptions`：运行时队列容量与背压
- `ConditionCacheOptions`：条件缓存清理间隔
- `StrategyOwnershipOptions`：策略租约与协调
- `WebSocketOptions`：WebSocket 路径、消息大小、连接数与 Redis Key TTL
- `RateLimitOptions`：HTTP/WS 限流
- `StartupOptions`：启动流程超时与预热
- `TradingOptions`：交易模式
- `NotificationOptions`：通知投递与重试
- `BusinessRulesOptions`：业务规则常量（角色、分享码、API Key 上限）
- `MarketDataQueryOptions`：行情查询/拉取相关限制
- `RedisKeyOptions`：Redis Key 命名规范
- `MonitoringOptions`：监控日志条目上限
- `RequestLimitsOptions`：请求体/协议相关限制
- `BacktestWorkerOptions`：分布式回测算力节点连接、心跳与分发间隔（含多核心地址列表 `CoreWsUrls`）

## 联动关系
- 全部业务模块：共享数据模型、协议封装、基础设施与中间件能力。
- `Backtest`：通过 `ServerRoleRuntime` 控制核心节点/算力节点功能开关，并通过 `BacktestWorkerOptions` 约束分发与心跳行为。
- `Backtest`：算力节点连接目标可通过 `ServerRoleBootstrap` 交互式录入并持久化，在启动时覆盖 `BacktestWorker:CoreWsUrls/CoreWsUrl`。
